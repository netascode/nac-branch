# The below code does the following:
#
# This YAML file defines the following network related templates: 
#
# - product_types
# - network_settings
# - snmp
# - syslog
# - nw_switch
# - nw_switch1
# - wireless
#
# Each template defines services configuration which is
# applicable to devices within the network / site to which 
# the template is applied.
#
# Note that these templates are not related to templates
# configured within the Cisco (formerly Meraki) dashboard.
#
meraki:
  template:
    networks:
      # 
      # The below code does the following:
      #
      # product_types configuration template.
      #
      # The product_types configuration template defines the 
      # devices (appliance, switch, wireless, camera, sensor,
      # cellularGateway) within the network / site to  which
      # the template is applied.
      #
      - name: product_types
        product_types:
                - appliance
                - switch
                - wireless
                - camera
                - sensor
                - cellularGateway
      # 
      # The below code does the following:
      #
      # network_settings configuration template.
      #
      # The network_settings template enables both
      # the local and remote status pages for devices within
      # network / site to which the template is applied. 
      # Additionally, it sets the credentials for access
      # to the local status page of the devices.  Note: this
      # configuration is for example only.  As a general 
      # recommendation - DO NOT hardcode sensitive
      # information such as credentials within any file which 
      # is checked into a version control system. 
      #  
      - name: network_settings
        settings:
          local_status_page_enabled: true
          remote_status_page: true
          secure_port: false
          local_status_page_authentication:
            username: ${local_status_page_username}
            password: "mEraki123%"
          named_vlans: true  
      # 
      # The below code does the following:
      #
      # snmp configuration template.
      #
      # The snmp template configures SNMPv3 access (username
      # and password) to devices within the site / netwwork 
      # to which the template is applied.  This does not 
      # configure any firewall settings restricting SNMP access,
      # which may be required based on the security policy of 
      # the organization.  Note: this configuraiton is for example
      # only.  As a general recommendation - DO NOT hardcode
      # sensitive information such as credentials within any file
      # which is checked into a version control system. 
      #      
      - name: snmp
        snmp:
          access: users
          users:
            - username: ${snmp_username}
              passphrase: Cisco123
      # 
      # The below code does the following:
      #
      # syslog configuration template.
      #
      # The syslog template configures a single remote
      # syslog server, defined as a variable.  UDP port 514
      # is configured as port on which syslog traffic is 
      # sent.  The configuration enables sending of all 
      # message categories / roles for all types of devices
      # in the site / network to which the template is applied.
      #     
      - name: syslog
        syslog_servers:
          - host: ${syslog_server}
            port: 514
            roles:
              - Switch event log
              - Air Marshal events
              - Flows
              - URLs
              - Wireless event log
              - Appliance event log
      # 
      # The below code does the following:
      #
      # nw_switch configuration template.
      #
      # The nw_switch template configures the following
      # for the switch within the network to which the
      # template is applied:
      #
      # - Sets the management VLAN to VLAN 1.
      #
      # - Sets any secondary power supply to be redundant
      #   power for the switch only.
      #
      # - Enables sampling of clients and traffic on the 
      #   detected uplink interface.
      #
      # - Sets the default MTU size of switch ports to 
      #   9100 bytes.
      #
      # - Sets the DHCP server policy of the switch to
      #   allow DHCP traffic. 
      #
      # - Defines the DSCP to CoS queue mapping assuming
      #   a 12-class QoS model, using all 8 CoS queues.
      #
      # - Defines an example set of QoS classification
      #   and marking rules for different VLANs on the switch.
      # 
      # - Restricts broadcast, multicast, and unknown unicast
      #   traffic to 30% of the available bandwidth of the 
      #   switch ports (storm control).
      #
      # - Defines an esample port schedule named "Weekend Only
      #   Port Schedule". Configures ports to which the schedule
      #   is applied to be available at all hours for all days
      #   of the week.
      #   
      - name: nw_switch
        switch:
          settings:
            vlan: 1
            use_combined_power: false
            uplink_client_sampling: true
            mac_blocklist: false
          mtu:
            default_mtu_size: 9100
          dhcp_server_policy:
            default_policy: allow
          dscp_to_cos_mappings:
            - cos: 0
              dscp: 8
              title: Scavenger CS1
            - cos: 0
              dscp: 10
              title: Bulk AF11
            - cos: 0
              dscp: 12
              title: Bulk AF12
            - cos: 0
              dscp: 14
              title: Bulk AF13
            - cos: 1
              dscp: 0
              title: Default CS0
            - cos: 2
              dscp: 16
              title: Network Mgmt CS2
            - cos: 2
              dscp: 18
              title: Transactional Data AF21
            - cos: 2
              dscp: 20
              title: Transactional Data AF22
            - cos: 2
              dscp: 22
              title: Transactional Data AF23
            - cos: 2
              dscp: 24
              title: Signaling CS3
            - cos: 3
              dscp: 26
              title: Multimedia Streaming AF31
            - cos: 3
              dscp: 28
              title: Multimedia Streaming AF32
            - cos: 3
              dscp: 30
              title: Multimedia Streaming AF33
            - cos: 3
              dscp: 40
              title: Broadcast Video CS5
            - cos: 4
              dscp: 32
              title: Realtime Interactive CS4
            - cos: 4
              dscp: 34
              title: Multimedia Conferencing AF41
            - cos: 4
              dscp: 36
              title: Multimedia Conferencing AF42
            - cos: 4
              dscp: 38
              title: Multimedia Conferencing AF43
            - cos: 5
              dscp: 44
              title: Admission-Controlled Voice EF
            - cos: 5
              dscp: 46
              title: Voice EF
            - cos: 5
              dscp: 48
              title: Internetwork Control CS6
            - cos: 5
              dscp: 56
              title: Network Control CS7
          qos_rules:
              - vlan: 20
                protocol: ANY
                dscp: -1
                qos_rule_name: Trust_DSCP_Voice_VLAN
              - vlan: 30
                protocol: ANY
                dscp: 0
                qos_rule_name: Remark_Guest_to_Default
              - vlan: 10
                protocol: UDP
                source_port_range: 16384-32767
                destination_port_range: 16385-32767
                dscp: 46
                qos_rule_name: Voice_to_EF_Data_VLAN
              - vlan: 10
                protocol: ANY
                dscp: 0
                qos_rule_name: Other_to_Default_Data_VLAN
          storm_control:
              broadcast_threshold: 30
              multicast_threshold: 30
              unknown_unicast_threshold: 30
          port_schedules:
                  - name: Weekend Only Port Schedule
                    port_schedule:
                        friday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        monday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        saturday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        sunday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        thursday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        tuesday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        wednesday:
                            active: true
                            from: 00:00
                            to: '24:00'
      # 
      # The below code does the following:
      #
      # wireless configuration template.
      #
      # The wireless template configures various parameters
      # under three main categories - settings, rf_profiles,
      # and ssids for the access points within the network to 
      # which the template is applied.  Note that the parameters
      # defined within this section are examples only.  They are 
      # not intended to be used directly in production networks, 
      # and are not considered to be any form of best-practice
      # configuration. 
      #
      # settings:  The settings sections configures various 
      # network-wide wireless device (AP) settings.
      #
      # rf-profiles:  The rf_profiles section configures a
      # single profile named "Corp wireless rf profile".  
      # 
      # - Clients are steered to the best available
      #   AP during association (client balancing).
      #
      # - Minimum bit rate supported is specified per
      #   RF band - 2.4, 5 GHz (6 GHz not enabled).
      #
      # - Selection of RF bands is configured on a 
      #   per-SSID level, rather than across all SSIDs
      #   to which the RF profile is applied.
      #
      # - For the 2.4 GHz RF band:
      #    - Minimum transmit power configured for 10 dBm
      #    - Maximum transmit power configured for 30 dBm
      #    - Minimum supported bit rate is 11 Mbps
      #    - Auto channel selection is left at the default of
      #      channels 1, 3, & 11.
      #    - Keeps 802.11ax enabled
      #    - Enables and sets the Receiver Start of Packet
      #      (RX-SOP) to -80 dBm
      #
      # - For the 5 GHz RF band: 
      #    - Minimum transmit power configured for 10 dBm
      #    - Maximum transmit power configured for 30 dBm
      #    - Minimum supported bit rate is 9 Mbps
      #    - Auto channel selection is configured to non-DFS
      #      channels 36, 40, 44 48, 157, and 161.
      #    - Channel width is set to 80 MHz
      #    - Keeps 802.11ax enabled
      #    - Enables and sets the Receiver Start of Packet
      #      (RX-SOP) to -80 dBm
      #
      # - Enables radio transmission.
      #
      # - Specific configuration for the "Guest" SSID for a minimum 
      #   bit rate of 11 Mbps, operating in the 5 GHz band.
      #
      # - Sets the RF profile as the default indoor and outdoor
      #   profile.
      #
      # ssid:  The SSIDs section hardcodes three SSIDs  - Data (SSID 0),
      # Voice (SSID 1), and Guest (SSID 3).
      #
      # - For the Data SSID:
      #     - Authentication mode is set to open (no encryption).
      #
      #     - Per-client and per-SSID rate limits are set to unlimited 
      #       (no rate-limiting).
      #
      #     - The 4 default traffic shaping rules are disabled.  Instead 
      #       a per-application traffic shaping rule identifies and classifies 
      #       5 different applications, then sets the DSCP marking of the traffic
      #       to CS2 (DSCP 16) and defines custom per bandwidth limits of 1 Mbps 
      #       upstream and downstream. (Note that applications must be specified 
      #       by ID currently.  Work to translate the IDs into user-friendly names 
      #       is ongoing). A second traffic shaping rule identifies traffic based 
      #       on host, IP subnet, and IP subnet with port, then sets the DSCP marking 
      #       of the traffic to CS3 (DSCP 24) with rate limiting set to the network
      #       default (unlimited).
      #
      #     - IP address assignment for wireless clients is via the DHCP server within 
      #       the security appliance (briged_mode).
      #
      #     - VLAN tagging is enabled with the assignment of the VLAN to which 
      #       the Data SSID is assigned defined as a variable.
      # 
      #     - An example SSID availability schedule for the weekend is defined.
      #
      # - For the Voice SSID:
      #     - Authentication mode is set to open (no encryption).
      #
      #     - Per-client and per-SSID rate limits are set to unlimited 
      #       (no rate-limiting).
      #
      #     - The 4 default traffic shaping rules are disabled.  Instead 
      #       a per-application traffic shaping rule identifies and classifies 
      #       one voice application, then sets the DSCP marking of the traffic
      #       to EF (DSCP 46) & CoS to 7; and allows the application to ignore any
      #       bandwidth limits. (Note that applications must be specified by ID
      #       currently. Work to translate the IDs into user-friendly names is ongoing). 
      #
      #     - IP address assignment for wireless clients is via the DHCP server within 
      #       the security appliance (briged_mode).
      #
      #     - VLAN tagging is enabled with the assignment of the VLAN to which 
      #       the Data SSID is assigned defined as a variable.
      # 
      #     - An example SSID availability schedule for the weekend is defined.
      #
      # - For the Guest SSID:
      #     - Authentication mode is set to open (no encryption).
      #
      #     - Per-client rate limits are set to 10 Mbps upstream and downstream.
      #
      #     - Per-SSID rate limits are set 100 Mbps upstream and downstream. 
      #
      #     - The 4 default traffic shaping rules are enabled.
      # 
      #     - IP address assignment for wireless clients is via the DHCP server within 
      #       the security appliance (briged_mode).
      #
      #     - VLAN tagging is enabled with the assignment of the VLAN to which 
      #       the Data SSID is assigned defined as a variable.
      #
      #     - A click-through splash-page is enabled for guest traffic. 
      # 
      #     - An example SSID availability schedule for the weekend is defined.
      #
      - name: wireless
        wireless:
                  settings:
                    meshing: false
                    ipv6_bridge: true
                    location_analytics: true
                    led_lights_on: true
                    upgrade_strategy: minimizeClientDowntime
                    named_vlans_pool_dhcp_monitoring:
                      enabled: false
                      duration: 5
                  rf_profiles:
                    - name: Corp wireless rf profile
                      client_balancing: true
                      min_bitrate_type: band
                      band_selection_type: ssid
                      ap_band_settings:
                      two_four_ghz_settings:
                        max_power: 30
                        min_power: 10
                        min_bitrate: 11
                        valid_auto_channels:
                            - 1
                            - 6
                            - 11
                        ax: true
                        rxsop: -80
                      five_ghz_settings:
                        max_power: 30
                        min_power: 10
                        min_bitrate: 9
                        valid_auto_channels:
                            - 36
                            - 40
                            - 44
                            - 48
                            - 157
                            - 161
                        channel_width: "80"
                        rxsop: -80
                      transmission: true
                      per_ssid_settings:
                        - ssid_name: "Guest"
                          min_bitrate: 11
                          band_operation_mode: 5ghz
                          bands:
                            - "5"
                          band_steering: true
                      is_indoor_default: true
                      is_outdoor_default: true
                  ssids:
                    - name: Data
                      ssid_number: '0'
                      traffic_shaping_rules:
                        default_rules: false
                        traffic_shaping: true
                        rules:
                          - definitions:
                              - type: application
                                value: meraki:layer7/application/332
                              - type: application
                                value: meraki:layer7/application/2249
                              - type: application
                                value: meraki:layer7/application/351
                              - type: application
                                value: meraki:layer7/application/2248
                              - type: application
                                value: meraki:layer7/application/2542
                            per_client_bandwidth_limits:
                              settings: custom
                              bandwidth_limits:
                                limit_up: 1000
                                limit_down: 1000
                            dscp_tag_value: 16
                          - definitions:
                              - type: host
                                value: nms.example.com
                              - type: ipRange
                                value: 158.43.128.0/24
                              - type: localNet
                                value: 192.168.0.0/16
                              - type: port
                                value: "161"
                            per_client_bandwidth_limits:
                              settings: network default
                            dscp_tag_value: 24
                      per_client_bandwidth_limit_down: 0
                      per_client_bandwidth_limit_up: 0
                      per_ssid_bandwidth_limit_down: 0
                      per_ssid_bandwidth_limit_up: 0
                      splash_page: None
                      enabled: true
                      ip_assignment_mode: Bridge mode
                      use_vlan_tagging: true
                      default_vlan_id: ${default-vlan-id-data}
                      ap_tags_and_vlan_ids:
                        - tags: 
                          - ${ap-tag1}
                          vlan_id: ${ap-tag1-vlan-id}
                        - tags:
                          - ${ap-tag2}
                          vlan_id: ${ap-tag1-vlan-id}
                      schedules:
                        enabled: ${data_ssid_schedules_enabled}
                        ranges:
                          - start_day: Sunday
                            start_time: 00:00:00
                            end_time: 06:00:00
                            end_day: Sunday
                          - start_day: Saturday
                            start_time: 00:00:00
                            end_time: 06:00:00
                            end_day: Saturday
                    - name: Voice
                      ssid_number: '1'
                      traffic_shaping_rules:
                        default_rules: false
                        traffic_shaping: true
                        rules:
                          - definitions:
                              - type: applicationCategory
                                value: "meraki:layer7/category/16"
                            per_client_bandwidth_limits:
                              settings: ignore
                            dscp_tag_value: 46
                            pcp_tag_value: 7
                      per_client_bandwidth_limit_down: 0
                      per_client_bandwidth_limit_up: 0
                      per_ssid_bandwidth_limit_down: 0
                      per_ssid_bandwidth_limit_up: 0
                      splash_page: None
                      enabled: true
                      ip_assignment_mode: Bridge mode
                      use_vlan_tagging: true
                      default_vlan_id: ${default-vlan-id-data}
                      ap_tags_and_vlan_ids:
                        - tags: 
                          - ${ap-tag1}
                          vlan_id: ${ap-tag1-vlan-id}
                        - tags:
                          - ${ap-tag2}
                          vlan_id: ${ap-tag1-vlan-id}
                      schedules:
                        enabled: ${voice_ssid_schedules_enabled}
                        ranges:
                          - start_day: Sunday
                            start_time: 00:00:00
                            end_time: 06:00:00
                            end_day: Sunday
                          - start_day: Saturday
                            start_time: 00:00:00
                            end_time: 06:00:00
                            end_day: Saturday  
                    - name: Guest
                      ssid_number: '2'
                      traffic_shaping_rules:
                        default_rules: true
                        traffic_shaping: true
                      per_client_bandwidth_limit_down: 10000
                      per_client_bandwidth_limit_up: 10000
                      per_ssid_bandwidth_limit_down: 100000
                      per_ssid_bandwidth_limit_up: 100000
                      enabled: true
                      ip_assignment_mode: Bridge mode
                      use_vlan_tagging: true
                      default_vlan_id: ${default-vlan-id-data}
                      ap_tags_and_vlan_ids:
                        - tags: 
                          - ${ap-tag1}
                          vlan_id: ${ap-tag1-vlan-id}
                        - tags:
                          - ${ap-tag2}
                          vlan_id: ${ap-tag1-vlan-id}   
                      splash_page: Click-through splash page
                      splash_settings:
                        allow_simultaneous_logins: true
                        billing:
                            free_access:
                                duration_in_minutes: 20
                                enabled: false
                            reply_to_email_address: digidev.gen@cisco.com
                        block_all_traffic_before_sign_on: true
                        controller_disconnection_behavior: default
                        guest_sponsorship:
                            guest_can_request_timeframe: false
                        splash_timeout: 1440
                        use_redirect_url: false
                        use_splash_url: false
                      schedules:
                        enabled: ${guest_ssid_schedules_enabled}
                        ranges:
                          - start_day: Sunday
                            start_time: 00:00:00
                            end_time: 06:00:00
                            end_day: Sunday
                          - start_day: Saturday
                            start_time: 00:00:00
                            end_time: 06:00:00
                            end_day: Saturday
      # 
      # The below code does the following:
      #
      # nw_switch1 configuration template.
      #
      # The nw_switch1 template configures the following
      # for the switch within the network to which the
      # template is applied:
      #
      # - Sets the management VLAN to VLAN 1.
      #
      # - Sets any secondary power supply to be redundant
      #   power for the switch only.
      #
      # - Enables sampling of clients and traffic on the 
      #   detected uplink interface.
      #
      # - Sets the default MTU size of switch ports to 
      #   9100 bytes.
      #
      # - Sets the DHCP server policy of the switch to
      #   allow DHCP traffic. 
      #
      # - Defines the DSCP to CoS queue mapping assuming
      #   a 12-class QoS model, using all 8 CoS queues.
      #
      # - Defines an example set of QoS classification
      #   and marking rules for different VLANs on the switch.
      # 
      # - Restricts broadcast, multicast, and unknown unicast
      #   traffic to 30% of the available bandwidth of the 
      #   switch ports (storm control).
      #
      # - Defines an esample port schedule named "Weekend Only
      #   Port Schedule". Configures ports to which the schedule
      #   is applied to be available at all hours for all days
      #   of the week.
      #   
      - name: nw_switch1
        switch:
          settings:
            vlan: 1
            use_combined_power: false
            uplink_client_sampling: true
            mac_blocklist: false
          mtu:
            default_mtu_size: 9100
          dhcp_server_policy:
            default_policy: allow
          dscp_to_cos_mappings:
            - cos: 0
              dscp: 8
              title: Scavenger CS1
            - cos: 0
              dscp: 10
              title: Bulk AF11
            - cos: 0
              dscp: 12
              title: Bulk AF12
            - cos: 0
              dscp: 14
              title: Bulk AF13
            - cos: 1
              dscp: 0
              title: Default CS0
            - cos: 2
              dscp: 16
              title: Network Mgmt CS2
            - cos: 2
              dscp: 18
              title: Transactional Data AF21
            - cos: 2
              dscp: 20
              title: Transactional Data AF22
            - cos: 2
              dscp: 22
              title: Transactional Data AF23
            - cos: 2
              dscp: 24
              title: Signaling CS3
            - cos: 3
              dscp: 26
              title: Multimedia Streaming AF31
            - cos: 3
              dscp: 28
              title: Multimedia Streaming AF32
            - cos: 3
              dscp: 30
              title: Multimedia Streaming AF33
            - cos: 3
              dscp: 40
              title: Broadcast Video CS5
            - cos: 4
              dscp: 32
              title: Realtime Interactive CS4
            - cos: 4
              dscp: 34
              title: Multimedia Conferencing AF41
            - cos: 4
              dscp: 36
              title: Multimedia Conferencing AF42
            - cos: 4
              dscp: 38
              title: Multimedia Conferencing AF43
            - cos: 5
              dscp: 44
              title: Admission-Controlled Voice EF
            - cos: 5
              dscp: 46
              title: Voice EF
            - cos: 5
              dscp: 48
              title: Internetwork Control CS6
            - cos: 5
              dscp: 56
              title: Network Control CS7
          qos_rules:
              - vlan: 20
                protocol: ANY
                dscp: -1
                qos_rule_name: Trust_DSCP_Voice_VLAN
              - vlan: 30
                protocol: ANY
                dscp: 0
                qos_rule_name: Remark_Guest_to_Default
              - vlan: 10
                protocol: UDP
                source_port_range: 16384-32767
                destination_port_range: 16385-32767
                dscp: 46
                qos_rule_name: Voice_to_EF_Data_VLAN
              - vlan: 10
                protocol: ANY
                dscp: 0
                qos_rule_name: Other_to_Default_Data_VLAN
          port_schedules:
                  - name: Weekend Only Port Schedule
                    port_schedule:
                        friday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        monday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        saturday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        sunday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        thursday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        tuesday:
                            active: true
                            from: 00:00
                            to: '24:00'
                        wednesday:
                            active: true
                            from: 00:00
                            to: '24:00'