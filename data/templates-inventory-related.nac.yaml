# The below code does the following:
#
# This YAML file defines the following inventory related template: 
#
# - Small Branch 112 (sb112)
# - Small Branch sb112 template defines 1 Appliance, 1 Switch, and 2 Access Points
#
# Each template defines network-level configuration which is 
# applicable to the inventory - meaning the security appliance,
# switch, and AP devices - within the site.
#
# Note that these templates are not related to templates
# configured within the Cisco (formerly Meraki) dashboard.
#
# The below code does the following:
#
# hub configuration template.
#
# The hub configuration template configures defines the
# device (security appliance)
# and configures parameters specific to those devices 
# within the site / network to which the template is applied.
#
meraki:
  template:
    networks:
       - name: hub
         devices:
          - name: ${appliance-01}
            serial: ${appliance-01-serial}
            tags:
              - test
            lat: ${lat}
            lng: ${lng}
            address: ${address}
            notes: Small Branch Notes Appliance
            appliance:
              uplinks_settings:
                wan1:
                  enabled: true
                  svis:
                    ipv4:
                      assignment_mode: dynamic
                wan2:
                  enabled: true
                  svis:
                    ipv4:
                      assignment_mode: dynamic       
       # 
       # The below code does the following:
       #
       # sb112 configuration template.
       #
       # The sb112 configuration template configures defines the
       # devices (security appliance, switch, and access points)
       # and configures parameters specific to those devices 
       # within the site / network to which the template is applied.
       #
       - name: sb112
         devices:
          # 
          # The below code does the following:
          #
          # Security appliance configuration
          #
          # Defines the name, serial number, geolocation coordinates 
          # (latitude & longitude), and address variables for the 
          # security appliance within the site to which the template 
          # is applied.
          #
          # Enables both WAN uplinks (WAN 1 and WAN 2) for the security 
          # appliance and specifies IPv4 dynamic (DHCP) address assignment 
          # for the security appliance within the site to which the 
          # template is applied.
          #
          - name: ${appliance-01}
            serial: ${appliance-01-serial}
            tags:
              - test
            lat: ${lat}
            lng: ${lng}
            address: ${address}
            notes: Small Branch Notes Appliance
            appliance:
              uplinks_settings:
                wan1:
                  enabled: true
                  svis:
                    ipv4:
                      assignment_mode: dynamic
                wan2:
                  enabled: true
                  svis:
                    ipv4:
                      assignment_mode: dynamic
          # 
          # The below code does the following:
          #
          # The switch configuration
          #
          # Defines the name, serial number, geolocation coordinates 
          # (latitude & longitude), and address variables for the 
          # first switch within the site to which the template 
          # is applied.
          #
          # Hardcodes the ports 1 - 13 of the switch to be trunk 
          # ports allowing VLANs 1 - 100.  Rapid Spanning-Tree Protocol
          # (RTSP) is enabled by default on the trunk ports. Link negotiation
          # (speed and duplex) is set to auto negotiate by default.
          #
          # Hardcodes ports 14 - 24 to be access ports on VLAN 1 with 
          # Voice VLAN 30.  Port isolation is enabled on the access ports
          # as an example only (devices on the access ports cannot 
          # communicate with eachother). RTSP is enabled by default with 
          # BPDU guard and storm control also enabled for access ports.
          # Link negotiation (speed and duplex) is explicitely set to auto
          # negotiate. 
          #
          # A port schedule named "Weekend Only Port Schedule" has been
          # assigned to all switch ports as an example only.  The schedule
          # itself is defined within the "nw_switch" template found within
          # the templates-network-related.nac.yaml file. 
          #
          - name: ${switch-01}
            serial: ${switch-01-serial}
            tags:
              - test
            lat: ${lat}
            lng: ${lng}
            address: ${address}
            notes: Small Branch Notes Switch
            switch:
              ports:
              - port_ids: 1-13
                name: trunk port to router and AP
                type: trunk
                allowed_vlans: 1-100
                port_schedule_name: "Weekend Only Port Schedule"
              - port_ids: 14-24
                name: User Port
                tags:
                  - tag1
                enabled: true
                type: access
                vlan: 1
                voice_vlan: 30
                isolation: true
                stp_guard: bpdu guard
                link_negotiation: Auto negotiate
                port_schedule_name: "Weekend Only Port Schedule"
                storm_control: true
          # 
          # The below code does the following:
          #
          # First access point configuration
          #
          # Defines the name, serial number, geolocation coordinates 
          # (latitude & longitude), and address variables for the 
          # first access point within the site to which the template 
          # is applied.
          #   
          - name: ${ap-01}
            serial: ${ap-01-serial}
            tags:
              - test
            lat: ${lat}
            lng: ${lng}
            address: ${address}
            notes: Small Branch Notes Access Point
          # 
          # The below code does the following:
          #
          # Second access point configuration
          #
          # Defines the name, serial number, geolocation coordinates 
          # (latitude & longitude), and address variables for the 
          # second access point within the site to which the template 
          # is applied.
          #            
          - name: ${ap-02}
            serial: ${ap-02-serial}
            tags:
              - test
            lat: ${lat}
            lng: ${lng}
            address: ${address}
            notes: Small Branch Notes Appliance
